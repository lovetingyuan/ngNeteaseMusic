!function(e){"use strict";e&&e.module("neteaseMusic",[]).service("styleService",["$timeout",function(t){var n={};this.setScope=function(e,t){n[e]=t},this.setStyleObj=function(i,o){e.isFunction(o)&&(o=o()),t(function(){var e,t;for(var r in n)if(n.hasOwnProperty(r)&&new RegExp("^"+i+"\\d*$").test(r)&&(e=n[r]))for(t in o)o.hasOwnProperty(t)&&(t in e&&console.warn("name of styleobj has existed in the scope!"),e[t]=o[t])})}}]).run(["$templateCache","$sce","styleService",function(t,n,i){t.put("player.html",'             <div>                 <div>                    <iframe ng-style="::mainIframeStyle" ng-src={{other.firstItem}} ng-show="!!other.firstItem" ></iframe>                     <div style="padding: 0 10px;" ng-show="other.showBar">                         <ul ng-style="::optionBarStyle" >                            <li ng-style="::optionBarStyleOne">                                <a ng-href="{{other.currentSong}}" target="_blank"                                 ng-show="!other.addMode" style="text-decoration:none;">网易云音乐</a>                                 <input name="addSongInput" type="url" ng-pattern="/^http://music\\.163\\.com/#/song\\?id=\\d+$/" autofocus placeholder="请输入网易云音乐链接" ng-model="other.theAddSongLink" ng-show="other.addMode" ng-style="::optionBarInputStyle"/>                             </li>                             <li ng-click="addSong()" title="添加歌曲" ng-style="::optionBarStyleTwo">{{other.addMode ? \'✔\' : \'✚\'}}</li>                            <li ng-click="other.showList = !other.showList" title="{{other.showList ? \'收起列表\' : \'展开列表\'}}" ng-style="::optionBarStyleTwo">&equiv;</li>                        </ul>                    </div>                 </div>                 <div ng-show="other.showList" ng-style="playListStyle">                     <music-item ng-repeat="song in other.playList track by $index"                          song-link="song" delete-song="deleteSong({index: $index})"                        set-song="setCurrentSong({index: $index})" style="position:relative;" />                 </div>             </div>         '),i.setStyleObj("player.html",{mainIframeStyle:{margin:0,padding:0,border:"0 none",width:"100%",marginBottom:"-12px"},optionBarStyle:{listStyle:"none",margin:0,padding:0,fontSize:"18px",height:"25px",lineHeight:"25px",color:"#898989",backgroundColor:"white",boxShadow:"0 0 10px #ccc",borderRadius:"2px"},optionBarInputStyle:{height:"25px",border:"0 none",outline:"none",width:"95%"},optionBarStyleOne:{"float":"left",marginLeft:"10px",fontSize:"13px"},optionBarStyleTwo:{"float":"right",marginRight:"10px",cursor:"pointer"},playListStyle:{position:"relative",top:"-8px"}}),t.put("song.item.html",'            <div>                <iframe ng-src="{{songLink}}" ng-style="::itemFrameStyle"></iframe>                 <div ng-show="iframeReady">                     <div ng-click="deleteSong()" title="删除该歌曲"                         ng-style="::itemDeleteBtnStyle">×</div>                     <div ng-click="setTheSong()" title="播放该歌曲"                         ng-style="::itemPlayBtnStyle">♫</div>                     <!-- <div style="position: absolute; background:white;height: 8px; left: 45px; right: 45px; top: 32px;"></div> -->                  </div>             </div>         '),i.setStyleObj("song.item.html",function(){var t={position:"absolute",top:"10px",width:"32px",height:"32px",lineHeight:"32px",textAlign:"center",cursor:"pointer"};return{itemFrameStyle:{margin:0,padding:0,border:"0 none",height:"52px",width:"100%",marginBottom:"-23px"},itemDeleteBtnStyle:e.extend({},t,{right:"10px",backgroundColor:"white",color:"#898989",borderRadius:"0 2px 2px 0",fontSize:"25px"}),itemPlayBtnStyle:e.extend({},t,{left:"10px",backgroundColor:"#f3f3f3",color:"#ED1C24",borderRadius:"2px 0 0 2px",fontSize:"20px"})}})}]).directive("musicItem",["$templateCache","styleService",function(e,t){return{restrict:"AE",replace:!0,scope:{songLink:"=",deleteSong:"&",setSong:"&"},template:e.get("song.item.html"),link:function(e,n){t.setScope("song.item.html"+e.$parent.$index,e);var i=n.find("iframe")[0];"onload"in i?i.onload=function(){e.iframeReady=!0,e.$digest()}:i.onreadystatechange=function(){"complete"===i.readyState&&(e.iframeReady=!0,e.$digest())},e.$on("setSong",function(){0===e.$parent.$index&&(e.iframeReady=!1)}),e.setTheSong=function(){0!==e.$parent.$index&&(e.iframeReady=!1,e.$emit("settingSong"),e.setSong())}}}}]).directive("musicPlayer",["$templateCache","$sce","styleService",function(t,n,i){return{restrict:"AE",replace:!0,require:"?ngModel",scope:{playConfig:"="},template:t.get("player.html"),link:function(t,o,r,a){function l(e){e=e.toString();var t=+e;return"number"==typeof t&&t===t?t:e.match(/(?:id\=)(\d+)/g)?+RegExp.$1:null}function s(e){return"http://music.163.com/outchain/player?type=2&id="+e+"&auto=0&height=32"}i.setScope("player.html",t),t.$on("settingSong",function(){t.$broadcast("setSong")});var d={autoPlay:!0,size:"normal",fold:!1};e.extend(d,t.playConfig||{});var u=o.find("iframe")[0];if(u.height=("small"===d.size?32:66)+20,"onload"in u?u.onload=function(){t.other.showBar=!0,t.$digest()}:u.onreadystatechange=function(){"complete"===u.readyState&&(t.other.showBar=!0,t.$digest())},t.other={showList:!d.fold,playList:[],addMode:!1,showBar:!1,theAddSongLink:"",currentSong:"",firstItem:""},!a)throw Error("directive musicPlayer has no ng-model!");a.$render=function(){if(t.other.playList.length=0,a.$modelValue&&0!==a.$modelValue.length){t.other.currentSong=a.$modelValue[0]?"http://music.163.com/#/song?id="+a.$modelValue[0]:"http://music.163.com/";var i=d.autoPlay?1:0,o="small"===d.size?32:66;t.other.firstItem=a.$modelValue[0]?n.trustAsResourceUrl("http://music.163.com/outchain/player?type=2&id="+a.$modelValue[0]+"&auto="+i+"&height="+o):"",e.forEach(a.$viewValue,function(e){t.other.playList.push(n.trustAsResourceUrl(e))})}},a.$formatters.push(function(t){var n=[];return e.forEach(t,function(e){n.push(s(e))}),n}),a.$parsers.push(function(t){var n=[];return e.forEach(t,function(e){n.push(l(e))}),n}),o.find("input").on("keydown",function(e){13===e.keyCode&&t.addSong().$digest()}),t.addSong=function(){if(t.other.addMode){if(t.other.theAddSongLink){var e=s(l(t.other.theAddSongLink));t.other.theAddSongLink="",a.$viewValue.push(e),a.$setViewValue(a.$viewValue.slice()),a.$render()}t.other.addMode=!1}else t.other.addMode=!0,o.find("input").val(""),setTimeout(function(){o.find("input")[0].focus()});return t},t.deleteSong=function(e){a.$viewValue.splice(e.index,1),a.$setViewValue(a.$viewValue.slice()),a.$render()},t.setCurrentSong=function(e){e=e.index;var t=a.$viewValue[e];a.$viewValue[e]=a.$viewValue[0],a.$viewValue[0]=t,a.$setViewValue(a.$viewValue.slice()),a.$render()}}}}])}(angular);